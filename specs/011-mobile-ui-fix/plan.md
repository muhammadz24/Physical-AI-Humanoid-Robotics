# Implementation Plan: Mobile UI Fix

**Branch**: `011-mobile-ui-fix` | **Date**: 2025-12-18 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/011-mobile-ui-fix/spec.md`

## Summary

Fix mobile UI issues on Android where the sidebar hamburger menu is broken and the ChatWidget button overlaps navigation elements. The solution involves adjusting z-index layering, adding/improving mobile-responsive CSS media queries, and enhancing Docusaurus navbar configuration for better mobile UX.

**Key Changes:**
1. Fix z-index layering to ensure proper UI element stacking (Navbar > ChatWidget)
2. Enhance mobile media queries for ChatWidget button and modal (<768px screens)
3. Add `hideOnScroll` behavior to navbar for improved mobile experience
4. Ensure no visual overlap between navigation controls and ChatWidget on mobile

## Technical Context

**Language/Version**: JavaScript/React (Docusaurus 3.x), CSS3
**Primary Dependencies**: Docusaurus v3.x, React, CSS Modules
**Storage**: N/A (frontend-only changes)
**Testing**: Manual testing on Android devices/Chrome DevTools mobile emulator
**Target Platform**: Web browsers, specifically mobile viewports (width < 768px, Android Chrome)
**Project Type**: Web (Docusaurus static site frontend)
**Performance Goals**: <100ms touch response time for interactive elements (hamburger menu, ChatWidget button)
**Constraints**:
  - Must follow Docusaurus best practices (Constitution Principle IV)
  - Must not break existing desktop UI
  - Changes must be minimal and focused (Principle I: Simplicity-First)
  - Build time must remain under 60 seconds (Principle VI)
**Scale/Scope**: 2 files modified (ChatWidget styles.module.css, docusaurus.config.js), ~30 lines of code

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| **I. Simplicity-First Design** | ✅ PASS | Changes are minimal and focused on specific mobile UI issues. No feature bloat. |
| **IV. Docusaurus Best Practices** | ⚠️ VERIFY | Must verify `hideOnScroll` is a documented Docusaurus navbar feature and follows official patterns. |
| **VI. Fast Build & Iteration Cycles** | ✅ PASS | CSS and config changes have negligible impact on build time. |
| **Performance Standards** | ✅ PASS | Changes improve mobile UX without degrading performance. CSS is lightweight. |

**Gate Decision**: PASS (with Phase 0 research required for Principle IV verification)

## Project Structure

### Documentation (this feature)

```text
specs/011-mobile-ui-fix/
├── plan.md              # This file
├── research.md          # Phase 0: Current state analysis & best practices
├── data-model.md        # N/A (no data entities)
├── quickstart.md        # Phase 1: Testing guide for mobile UI
├── contracts/           # N/A (no API contracts)
└── tasks.md             # Phase 2: Generated by /sp.tasks
```

### Source Code (repository root)

```text
src/
├── components/
│   └── ChatWidget/
│       ├── index.js                    # No changes required
│       └── styles.module.css           # MODIFY: z-index, mobile media queries
│
docusaurus.config.js                    # MODIFY: Add navbar.hideOnScroll
```

**Structure Decision**: This is a Docusaurus-based web application. Changes are isolated to:
1. ChatWidget component styles (src/components/ChatWidget/styles.module.css)
2. Docusaurus site configuration (docusaurus.config.js)

No new files or components required. Modifications are minimal and surgical.

## Complexity Tracking

No constitution violations. All changes align with simplicity-first design and Docusaurus best practices.

## Phase 0: Research & Analysis

### Current State Analysis

**Findings from codebase inspection:**

1. **Z-Index Values (src/components/ChatWidget/styles.module.css):**
   - `floatingButton`: z-index 99 (line 14) ✅
   - `chatModal`: z-index 98 (line 44) ✅
   - `selectTooltip`: z-index 100 (line 297) ⚠️ **POTENTIAL ISSUE**

2. **Mobile Media Queries:**
   - Existing mobile styles at lines 362-384 ✅
   - Breakpoint: `@media (max-width: 768px)`
   - Button sizing: 56px × 56px on mobile (reduced from 60px desktop)
   - Modal: Full-screen on mobile

3. **Docusaurus Config:**
   - `navbar.hideOnScroll`: ❌ **NOT PRESENT** (needs to be added)
   - Navbar structure exists with items configured

### Research Tasks

1. **Verify Docusaurus navbar.hideOnScroll feature** (Constitution IV compliance)
   - Confirm it's an official Docusaurus feature
   - Check documentation: https://docusaurus.io/docs/api/themes/configuration
   - Determine correct configuration syntax

2. **Analyze z-index issue:**
   - Docusaurus navbar default z-index (typically 100-200)
   - selectTooltip z-index: 100 might conflict with navbar
   - Determine if z-index needs adjustment

3. **Identify hamburger menu overlap cause:**
   - Button position on mobile: bottom-right
   - Hamburger menu position: top-left (Docusaurus default)
   - Check if selectTooltip or other elements cause overlap

4. **Review mobile UX best practices:**
   - Optimal button sizes for touch targets (iOS: 44px, Android: 48px)
   - Safe area insets for notched devices
   - Z-index conventions for overlays vs navigation

### Research Output Location

See `research.md` in this directory for detailed findings and decisions.

## Phase 1: Design & Implementation

**Prerequisites:** research.md complete

### Design Decisions

1. **Z-Index Layering Strategy:**
   - Navbar: 1000+ (Docusaurus default, verify in research)
   - selectTooltip: 999 (below navbar, above ChatWidget)
   - floatingButton: 99 (current, no change needed)
   - chatModal: 98 (current, no change needed)

2. **Mobile Media Queries Enhancement:**
   - Verify 768px breakpoint is optimal
   - Consider adding 320px breakpoint for very small screens
   - Adjust button positioning if needed (safe margins)

3. **Navbar Configuration:**
   - Add `hideOnScroll: true` to navbar config
   - Verify no breaking changes to existing navbar behavior

### Implementation Files

1. **src/components/ChatWidget/styles.module.css:**
   - Adjust `selectTooltip` z-index from 100 to 999
   - Review and enhance mobile media queries if needed
   - Add comments for z-index rationale

2. **docusaurus.config.js:**
   - Add `hideOnScroll: true` to navbar configuration
   - Verify placement in themeConfig.navbar object

### Testing Guide

See `quickstart.md` for:
- Manual testing steps on Android devices
- Chrome DevTools mobile emulation test cases
- Visual regression checklist (desktop vs mobile)
- Touch target accessibility verification

## Phase 2: Task Generation

**Next step:** Run `/sp.tasks` to generate testable tasks from this plan.

The task list will include:
- Update selectTooltip z-index in styles.module.css
- Add hideOnScroll to docusaurus.config.js navbar
- Manual testing on Android devices (multiple screen sizes)
- Visual regression testing (desktop unchanged)
- Accessibility verification (touch targets, WCAG compliance)

## Notes

**Why minimal changes:**
- Existing mobile media queries are comprehensive
- Z-index values are mostly correct (only selectTooltip needs adjustment)
- hideOnScroll is the only missing Docusaurus feature

**Risk mitigation:**
- Changes are isolated and easy to rollback
- No build process impact
- Desktop UI remains untouched
- Can be tested thoroughly before deployment
